# syntax=docker/dockerfile:1.7
FROM python:3.12-slim

ARG APP_USER=app
RUN useradd -m ${APP_USER}
WORKDIR /app

RUN apt-get update && apt-get install -y --no-install-recommends \
    ca-certificates curl build-essential && rm -rf /var/lib/apt/lists/*

RUN pip install --no-cache-dir uv
COPY pyproject.toml uv.lock ./
RUN uv export --no-dev --frozen --format requirements.txt --output-file requirements.lock && \
    uv pip sync --system requirements.lock

COPY src ./src
COPY sql ./sql
RUN uv pip install --system --no-deps -e .

ENV PYTHONUNBUFFERED=1
EXPOSE 8000
USER ${APP_USER}

ENTRYPOINT ["python", "-m", "mcp_vertica", "--transport", "http", "--port", "8000"]
